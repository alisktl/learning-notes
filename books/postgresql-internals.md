# PostgreSQL 16 изнутри
by Рогов Егор Валерьевич

- Часть 0.
  - Глава 1. Введение
    1. Организация данных
    2. Процессы и память
    3. Клиенты и клиент - серверный протокол
- Часть I. Изоляция и многоверсионность
  - Глава 2. Изоляция
    1. Согласованность
    2. Уровни изоляции и аномалии в стандарте SQL
    3. Уровни изоляции в PostgreSQL
   
---

## Глава 1. Введение

### Организация данных

#### Базы данных
- `PostgreSQL` - программа, которая относится к классу систем управления [базами данных](https://postgrespro.ru/docs/postgresql/16/managing-databases). Когда эта программа выполняется, мы называем ее `сервером` PostgreSQL, или `экземпляром` сервера.
- Данные, которыми управляет PostgreSQL, хранятся в `базах данных`.
- Один экземпляр PostgreSQL одновременно работает с несколькими базами, которые вместе называются `кластером баз данных`.
- Чтобы кластер можно было использовть, его необходимо `инициализировать` [[`initdb`](https://postgrespro.ru/docs/postgresql/16/app-initdb)]. Каталог, в котором размещаются все файлы, относящиеся к кластеру, обычно называют словом `PGDATA`. Обычно `PGDATA` находится в `/var/lib/pgsql/data`.
- При инициализации в PGDATA создаются три одинаковые базы данных:
  - `template0` - неизменяемый эталон
  - `template1` - настраиваемый шаблон для новых баз.
  - `postgres` - удобная «рабочая» БД для администрирования и тестов.
 
#### Системный каталог
- Метаинформация обо всех объектах кластера (таких как таблицы, индексы, типы данных или функции) хранится в таблицах, относящихся к [`системному каталогу`](https://postgrespro.ru/docs/postgresql/16/catalogs).
- К системному каталогу можно обращаться с помощью обычных запросов SQL, а изменения в нем происходят при выполнении команд DDL.

#### Схемы
- [`Схемы`](https://postgrespro.ru/docs/postgresql/16/ddl-schemas) представляют собой пространства имен для всех объектов, хранящихся в базе данных.
- Кроме пользовательских схем, имеется несколько специальных служебных:
  - `public` используется по умолчанию для пользовательских объектов, если не выполнены иные настройки
  - `pg_catalog` используется для таблиц системного каталога
  - `information_schema` дает альтернативное представление системного каталога, регламентируемое стандартом SQL
  - `pg_toast` используется для объектов, относящихся к TOAST
  - `pg_temp` объединяет временные таблицы

 #### Табличные пространства
- В отличие от логического рапсределения объектов по базам данных и схемам, `табличные пространства` определяют физическое расположение данных. Фактически табличное пространство - это каталог файловой системы.
- При инициализации кластера создаются два табличных пространства:
  - `pg_default` располагается в каталоге PGDATA/base и используется как табличное пространство по умолчанию, если явно не выбрать для этой цели другое пространство.
  - `pg_global` располагается в каталоге PGDATA/global и хранит общие для всего кластера объекты системного каталога.

#### Отношения
- В PostgreSQL, `relation` — это обобщённый термин для структурированных наборов строк (кортежей) с фиксированным набором столбцов (атрибутов). Проще говоря, relation — это таблица в самом классическом понимании, но в более широком смысле так же называют и индексы, последовательности, представления и другие объекты, хранящиеся в системном каталоге.

```sql
SELECT relname, relkind
FROM pg_catalog.pg_class c
     JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
WHERE n.nspname = 'public';
```

#### Слои и файлы
- Информация, связанная с отношением, организована в несколько [`слоев`](https://postgrespro.ru/docs/postgresql/16/storage-file-layout) (`forks`) разных типов,каждый из них содержит определенный вид данных.

